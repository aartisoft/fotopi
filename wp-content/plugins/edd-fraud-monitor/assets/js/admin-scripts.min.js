jQuery(document).ready(function(a){var b={init:function(){this.add(),this.remove(),this.email(),this.countries(),this.behavior()},clone_repeatable:function(b){var c=highest=0;return b.parent().find("tr").each(function(){var b=a(this).data("key");parseInt(b)>highest&&(highest=b)}),c=highest+=1,clone=b.clone(),clone.find("select").each(function(){a(this).val(b.find('select[name="'+a(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",c),clone.find("td input, td select").val(""),clone.find(".search-choice").remove(),clone.find("td input, td select").each(function(){var b=a(this).attr("name");b&&(b=b.replace(/\[(\d+)\]/,"["+parseInt(c)+"]"),a(this).attr("name",b).attr("id",b))}),clone.find(".chosen-container").remove(),clone},add:function(){a("#eddfm_add_condition").click(function(c){c.preventDefault();var e=(a(this),a("#eddfm-product-combinations tr:last"));clone=b.clone_repeatable(e),clone.insertAfter(e).find("input, textarea, select").filter(":visible").eq(0).focus(),clone.find(".edd-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option}),clone.find(".edd-select-chosen","#choose-download").css("width","100%")})},remove:function(){a("body").on("click",".eddfm_remove_condition",function(b){b.preventDefault();var c=a(this).parent().parent("tr"),d=a("#eddfm-product-combinations .condition-row").length,f=c.data("key");a('.edd_repeatable_condition_field option[value="'+f+'"]').remove(),d>1?c.remove():(c.find("td input, td select").val(""),c.find(".search-choice").remove());var g=0;a("#eddfm-product-combinations .condition-row").each(function(){a(this).attr("data-key",g),a(this).find("td input, td select").each(function(){var b=a(this).attr("name");b&&(b=b.replace(/\[(\d+)\]/,"["+parseInt(g)+"]"),a(this).attr("name",b).attr("id",b))}),g++})})},email:function(){a(".email-check-box").change(function(){a(this).parent().next(".email-content").toggle()}),a(".eddfm-show-tags").on("click",function(b){b.preventDefault(),a(this).parent().next(".eddfm-email-tags").toggle(),a(this).toggle()}),a(".eddfm-hide-tags").on("click",function(b){b.preventDefault(),a(this).parent().toggle(),a(this).parent().prev().find(".eddfm-show-tags").toggle()})},countries:function(){a("#ip-lookup-service").change(function(){a("#geo-ip-service-notices span").hide();var b=a(this).val();a('#geo-ip-service-notices [data-service="'+b+'"]').show()}),a("#geofence-enabled").change(function(){var b=a(this).is(":checked");b?(a(".geofence-settings .edd-fm-toggle").show(),a("#edd_fm_geofence_fence").trigger("change")):a(".geofence-settings .edd-fm-toggle").hide()}),a("#edd_fm_geofence_fence").change(function(){var b=a(this).val();a(".geofence-settings .geofence-type").hide(),a(".geofence-settings .geofence-type."+b).show(),"distance"===b?a(".edd-fm-toggle.geofence-range").show():a(".edd-fm-toggle.geofence-range").hide()})},behavior:function(){a("#user-has-purchases").change(function(){var b=a(this).is(":checked");b?a("#user-created-threshold").show():a("#user-created-threshold").hide()})}};b.init();var c={init:function(){this.actions()},actions:function(){a("#confirm-as-fraud").click(function(b){b.preventDefault(),a("#accept-as-valid").attr("disabled","disabled"),a("#fraud-actions").trigger("change"),a("#eddfm-fraud-actions-complete").slideDown()}),a("#fraud-actions").change(function(){var b=a(this).val(),c=a(".revoke-delete-warning"),d=a(".refund-warning");if("-1"!==b)switch(b){case"revoked":case"delete":d.hide(),c.show();break;case"refunded":default:c.hide(),d.show()}}),a("#eddfm-cancel-is-fraud").click(function(b){b.preventDefault(),a("#eddfm-fraud-actions-complete").slideUp(),a("#accept-as-valid").removeAttr("disabled")}),a(".complete-fraud").click(function(b){b.preventDefault(),a("#eddfm-confirm").attr("disabled","disabled"),a("#eddfm-cancel-is-fraud").hide(),a("#eddfm-fraud-actions-complete .spinner").show().css("visibility","visible");var c=a('input[name="eddfm_payment_id"]').val(),d=a('input[name="eddfm_action"]').val(),e=a('select[name="eddfm_actions"]').val(),f=a('input[name="eddfm_fraud_nonce"]').val(),g={payment_id:c,edd_action:d,status:e,nonce:f};a.post(ajaxurl,g,function(b){var c=a(".eddfm-message");c.html(b.message).show(),!0===b.success?setTimeout(function(){window.location.replace(b.redirect)},2e3):(a("#eddfm-confirm").removeAttr("disabled"),a("#eddfm-cancel-is-fraud").show(),a("#eddfm-fraud-actions-complete .spinner").hide().css("visibility","hidden"))},"json")}),a("#edd-fm-action").change(function(){var b=a(this).val();"fraud"===b?a("#edd-payment-mark-as-fraud .edd-fm-toggle").show():a("#edd-payment-mark-as-fraud .edd-fm-toggle").hide()}),a("#edd-fm-flag-payment").click(function(b){a("#edd-fm-flag-payment").attr("disabled","disabled"),b.preventDefault();var c=a("#edd-fm-action").val(),d=a("#edd-fm-flag-payment").data("payment-id"),e="manual_fraud",f=!1;"fraud"===c&&(f=a('input[name="edd-fm-status"]:checked').val());var g=a("#edd-payment-fraud-reason").val(),h=a('input[name="edd-fm-flag-payment"]').val();a("#edd-payment-mark-as-fraud .spinner").show().css("visibility","visible");var i={payment_id:d,status:f,flag_as:c,reason:g,nonce:h,edd_action:e};a.post(ajaxurl,i,function(b){var c=a(".eddfm-message");c.html(b.message).show(),!0===b.success?setTimeout(function(){window.location.replace(b.redirect)},2e3):(a("#edd-fm-flag-payment").removeAttr("disabled"),a("#edd-payment-mark-as-fraud .spinner").show().css("visibility","visible"))},"json")})}};c.init()});